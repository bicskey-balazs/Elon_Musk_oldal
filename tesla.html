<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="script.js" defer></script>
    <title>Tesla</title>
</head>
<body>
    <div class="navbar">
        <div class="topnav">
            <a href="index.html">ELON</a>
            <a href="spacex.html">SpaceX</a>
            <a href="tesla.html" aria-label="active">Tesla</a>
            <a href="Neuralink.html">Neuralink</a>
        </div>
    </div>

    <ul class="quickNav">
        <li aria-label="selected">
            <a href="#S" class="noselect">Model S</a>
        </li>
        <li>
            <a href="#3" class="noselect">Model 3</a>
        </li>
        <li>
            <a href="#X" class="noselect">Model X</a>
        </li>
        <li>
            <a href="#Y" class="noselect">Model Y</a>
        </li>
    </ul> 

    <div class="cnt">
        <section id="S" class="car noselect">
            <h1>Tesla Model S</h1>
            <div class="view360">
                <img src="képek/ModelS/0.png" alt="">
                <div class="slider">
                    <div class="handle" style="left: 0;">
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </div>
                </div>
            </div>
        </section>
        <section id="3" class="car noselect">
            <h1>Tesla Model 3</h1>
            <div class="view360">
                <img src="képek/Model3/0.png" alt="">
                <div class="slider">
                    <div class="handle" style="left: 0">
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </div>
                </div>
            </div>
        </section>
        <section id="X" class="car noselect">
            <h1>Tesla Model X</h1>
            <div class="view360">
                <img src="képek/ModelX/0.png" alt="">
                <div class="slider">
                    <div class="handle" style="left: 0">
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </div>
                </div>
            </div>
        </section>
        <section id="Y" class="car noselect">
            <h1>Tesla Model Y</h1>
            <div class="view360">
                <img src="képek/ModelY/0.png" alt="">
                <div class="slider">
                    <div class="handle" style="left: 0">
                        <i class="fa fa-angle-left" aria-hidden="true"></i>
                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                    </div>
                </div>
            </div>
        </section>
    </div>
</body>
</html>

<style>
    .slider .handle {
        background-color: rgb(120, 120, 120); 
        width: 50px; 
        height: 20px;
        position: absolute; 
        bottom: 50%; 
        translate: 0 50%;
        border-radius: 50px;
        transform: scale(100%);
        transition:
         transform .2s ease-in-out,
         background-color .2s ease-in-out;
        cursor: e-resize;
        left: calc(50/44) + "px";
        display: flex;
        justify-content: space-evenly;
        align-items: center;
    }

    .slider .handle:hover,
    .slider .handle:active,
    .slider .handle:focus {
        background-color: rgb(160, 160, 160);
        transform: scale(120%);
    }

    .slider .handle i{
        margin: 0 10px;
        color: rgb(244, 244, 244);
        font-size: 1.2rem;
        font-weight: 800;
    }

    .slider {
        background-color: rgba(70, 70, 70, 0.3); 
        width: 500px; 
        height: 5px; 
        margin: 0 auto; 
        position: relative; 
        margin-top: 20px;
        border-radius: 50px;
    }
    
    .quickNav {
        position: fixed;
        top:50%;
        left:0;
        transform: translate("-50% -50%");
        list-style-type: disc;
        padding-left: 30px;
        z-index: 999;
    }

    .quickNav li{
        color: rgb(111, 111, 111);
        font-size: 1.1rem;
        transition: all .2s linear;
        margin-bottom: 4px;
    }

    .quickNav li[aria-label="selected"]{
        color: rgb(244, 244, 244);
        font-size: 1.3rem;
    }

    .quickNav li:hover{
        color: rgb(244, 244, 244);
        padding-left: 5px;
    }

    .quickNav a{
        color: inherit;
        text-decoration: none;
    }

    .car h1{
        margin: 50px 0 50px 0;
        font-size: 2rem;
        text-shadow: 3px 3px 0px rgb(88, 88, 88);
    }

    .cnt{
        height: 100vh;
        overflow-y: auto;
        scroll-snap-type: y mandatory;
        scroll-behavior: smooth;
    }

    .car{
        scroll-snap-align: start;
        height: 100vh;
        text-align: center;
        padding-top: 50px;
    }

    .view360 img{
        height: 500px;
        clip-path: inset(50px 10px 50px 10px round 20px);
    }
</style>

<script defer>
    const clamp = (num, min, max) => Math.min(Math.max(num, min), max);

    function quickNav(){
        const contentWindow = document.querySelector(".cnt");
        const contentChild = document.querySelectorAll(".cnt section");
        const navElements = document.querySelectorAll(".quickNav li");

        contentWindow.addEventListener("scroll", (e)=>{
            for(let i = 0; i < contentChild.length; i++){
                var height = contentChild[i].offsetHeight;
                var scroll = contentWindow.scrollTop;

                var current = Math.floor(scroll/height);

                for(let j = 0; j < navElements.length; j++){  
                    if (j == current) navElements[j].setAttribute("aria-label", "selected");
                    else navElements[j].removeAttribute("aria-label");
                }
            }
        });
    }

    function Rotate360(){
        const handles = document.querySelectorAll(".handle");

        var target = null;

        handles.forEach(handle => {
            handle.addEventListener("mousedown", (e)=>{
                target = e.target;
            }); 
        });

        window.addEventListener("mousemove", (e) => {
            if(target == null){ return; }

            RotateTesla(e.clientX, target);
        });

        window.addEventListener("mouseup", ()=>{
            target = null;  
        });
    }


    function RotateTesla(cursorX, handle){
        var slider = handle.parentElement;
        var image = slider.previousElementSibling;
        var model = handle.parentElement.parentElement.parentElement.id;
        var picNum = 50;

        let midHandle = handle.offsetWidth/2;
        let newPos = (cursorX - slider.offsetLeft - midHandle);
        
        newPos = clamp(newPos, 0, slider.offsetWidth - midHandle);
        
        let divider = slider.offsetWidth / picNum;
        let snappedPos = Math.round(newPos / divider) * divider;
        
        let currentPic = snappedPos / divider;
        
        handle.style.left = snappedPos + "px";
        image.src = "képek/Model"+ model +"/"+ currentPic + ".png";
    }
    
    quickNav();
    Rotate360();

</script>
